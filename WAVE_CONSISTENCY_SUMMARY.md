# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–æ–ª–Ω: –ö—Ä–∞—Ç–∫–∏–π –æ—Ç—á—ë—Ç

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢: –î–∞–Ω–Ω—ã–µ –ö–û–ù–°–ò–°–¢–ï–ù–¢–ù–´

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –æ –≤–æ–ª–Ω–∞—Ö –æ—Ç ingestion –∫ sea rubric.

**–í—ã–≤–æ–¥:** –¶–µ–ø—å –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞. –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –ù–ï–¢.

---

## –¶–µ–ø—å –¥–∞–Ω–Ω—ã—Ö

```
Vision API (sea_wave_score)
    ‚Üì
ingestion.py (wave_score_value)
    ‚Üì
data_access.save_asset() ‚Üí DB column: photo_wave
    ‚Üì
data_access.fetch_sea_candidates() ‚Üí –ß–∏—Ç–∞–µ—Ç —Å fallback:
    1. wave_score_0_10 (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ)
    2. vision_wave_score (—Å—ã—Ä–æ–µ)
    3. photo_wave ‚Üê –æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å
    4. vision JSON
    ‚Üì
Candidate dict: {wave_score, photo_wave}
    ‚Üì
_publish_sea() ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç wave_score –¥–ª—è:
    - Calm seas guard (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
    - Scoring system (–æ—Ü–µ–Ω–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤)
    - Stage-based selection (–º–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç—ã–π –æ—Ç–±–æ—Ä)
```

---

## –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è –ë–î

| –ü–æ–ª–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|------------|
| `photo_wave` | ingestion.py | –û—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ, –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ |
| `vision_wave_score` | –ú–∏–≥—Ä–∞—Ü–∏–∏/backfills | –°—ã—Ä–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç Vision API |
| `vision_wave_conf` | –ú–∏–≥—Ä–∞—Ü–∏–∏/backfills | –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å Vision API |
| `wave_score_0_10` | –ú–∏–≥—Ä–∞—Ü–∏–∏/backfills | –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ 0-10 |
| `wave_conf` | –ú–∏–≥—Ä–∞—Ü–∏–∏/backfills | –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å |

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ sea rubric

### 1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (Calm Seas Guard)
- **–£—Å–ª–æ–≤–∏–µ:** target_wave_score ‚â§ 1 –ò –µ—Å—Ç—å —Å–ø–æ–∫–æ–π–Ω—ã–µ —Ñ–æ—Ç–æ
- **–î–µ–π—Å—Ç–≤–∏–µ:** –£–¥–∞–ª—è–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç—ã —Å wave_score ‚â• 5
- **–¶–µ–ª—å:** –ù–µ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —à—Ç–æ—Ä–º–æ–≤—ã–µ —Ñ–æ—Ç–æ –ø—Ä–∏ —Å–ø–æ–∫–æ–π–Ω–æ–º –º–æ—Ä–µ

### 2. –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏
- **WaveDeltaPenalty:** –®—Ç—Ä–∞—Ñ –∑–∞ —Ä–∞–∑–Ω–∏—Ü—É —Å —Ü–µ–ª–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
- **WaveCorridorPenalty:** –®—Ç—Ä–∞—Ñ –∑–∞ –≤—ã—Ö–æ–¥ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∫–æ—Ä–∏–¥–æ—Ä–∞
- **CalmWaveBonus:** +5.0 –¥–ª—è —Å–ø–æ–∫–æ–π–Ω—ã—Ö –≤–æ–ª–Ω –ø—Ä–∏ —Å–ø–æ–∫–æ–π–Ω–æ–π –ø–æ–≥–æ–¥–µ
- **CalmWavePenalty:** –®—Ç—Ä–∞—Ñ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ calm_wave_cap

### 3. –ú–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç—ã–π –æ—Ç–±–æ—Ä
- **B0:** –°—Ç—Ä–æ–≥–∏–π –∫–æ—Ä–∏–¥–æ—Ä (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π tolerance)
- **B1:** –£–º–µ—Ä–µ–Ω–Ω—ã–π –∫–æ—Ä–∏–¥–æ—Ä
- **B2:** –®–∏—Ä–æ–∫–∏–π –∫–æ—Ä–∏–¥–æ—Ä
- **AN:** –ü–æ—á—Ç–∏ –ª—é–±—ã–µ —Ñ–æ—Ç–æ (Accept Nearly)

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º (–ù–ï –≤ data flow)

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö:** –°—Ç–∞—Ä—ã–µ —Ñ–æ—Ç–æ –±–µ–∑ wave_score
2. **–û—à–∏–±–∫–∏ Vision API:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–ª–Ω
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ tolerance:** –°–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–µ –∫–æ—Ä–∏–¥–æ—Ä—ã –≤ STAGE_CONFIGS
4. **NULL –∑–Ω–∞—á–µ–Ω–∏—è:** Vision API –Ω–µ –≤–µ—Ä–Ω—É–ª sea_wave_score

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. ‚úÖ **Data flow –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω** ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è
2. üîç **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å–ª—É—á–∞–∏ photo_wave is None
3. üîß **Backfill:** –ó–∞–ø–æ–ª–Ω–∏—Ç—å wave_score_0_10 –¥–ª—è –≤—Å–µ—Ö sea —Ñ–æ—Ç–æ
4. üìä **–ú–µ—Ç—Ä–∏–∫–∏:** –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å wave_score –ø—É–±–ª–∏–∫–∞—Ü–∏–π —Å –ø–æ–≥–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
5. ‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å tolerance/penalty –≤ STAGE_CONFIGS

---

## –§–∞–π–ª—ã –∏ –º–µ—Ç–æ–¥—ã

### Ingestion
- `ingestion.py:1212-1253` ‚Äî –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ wave_score –∏–∑ vision_payload
- `data_access.py:save_asset()` ‚Äî –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ photo_wave

### Sea Rubric
- `data_access.py:fetch_sea_candidates()` ‚Äî –ß—Ç–µ–Ω–∏–µ —Å fallback chain
- `main.py:_publish_sea()` ‚Äî –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- `main.py:13741-13778` ‚Äî Calm seas guard
- `main.py:13789-13875` ‚Äî –°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

### –¢–µ—Å—Ç—ã
- `tests/test_calm_seas_guard_rules.py`
- `tests/test_sea_scoring_integration.py`
- `tests/test_ingestion_helper_consistency.py`

---

**–ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç:** –°–º. `WAVE_DATA_CONSISTENCY_ANALYSIS.md`
